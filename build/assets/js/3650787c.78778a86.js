"use strict";(self.webpackChunkdocu=self.webpackChunkdocu||[]).push([[7543],{3905:(e,n,o)=>{o.d(n,{Zo:()=>u,kt:()=>g});var t=o(67294);function a(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function r(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function i(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(n){a(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function l(e,n){if(null==e)return{};var o,t,a=function(e,n){if(null==e)return{};var o,t,a={},r=Object.keys(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||(a[o]=e[o]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)o=r[t],n.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=t.createContext({}),c=function(e){var n=t.useContext(s),o=n;return e&&(o="function"==typeof e?e(n):i(i({},n),e)),o},u=function(e){var n=c(e.components);return t.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var o=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(o),g=a,m=d["".concat(s,".").concat(g)]||d[g]||p[g]||r;return o?t.createElement(m,i(i({ref:n},u),{},{components:o})):t.createElement(m,i({ref:n},u))}));function g(e,n){var o=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=o[c];return t.createElement.apply(null,i)}return t.createElement.apply(null,o)}d.displayName="MDXCreateElement"},4618:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var t=o(87462),a=(o(67294),o(3905));const r={},i="Updating Gradle Dependencies",l={unversionedId:"contributing-to-airbyte/gradle-dependency-update",id:"contributing-to-airbyte/gradle-dependency-update",title:"Updating Gradle Dependencies",description:"We use Gradle Catalogs",source:"@site/../docs/contributing-to-airbyte/gradle-dependency-update.md",sourceDirName:"contributing-to-airbyte",slug:"/contributing-to-airbyte/gradle-dependency-update",permalink:"/contributing-to-airbyte/gradle-dependency-update",draft:!1,editUrl:"https://github.com/airbytehq/airbyte/blob/master/docs/../docs/contributing-to-airbyte/gradle-dependency-update.md",tags:[],version:"current",frontMatter:{},sidebar:"mySidebar",previous:{title:"Gradle Cheatsheet",permalink:"/contributing-to-airbyte/gradle-cheatsheet"},next:{title:"Updating Documentation",permalink:"/contributing-to-airbyte/updating-documentation"}},s={},c=[{value:"Setup Details",id:"setup-details",level:3},{value:"The version catalog TOML file format",id:"the-version-catalog-toml-file-format",level:4},{value:"Declaring a version catalog",id:"declaring-a-version-catalog",level:4},{value:"Sharing Catalogs",id:"sharing-catalogs",level:4},{value:"Configure the Plugin Publishing Plugin",id:"configure-the-plugin-publishing-plugin",level:4}],u={toc:c};function p(e){let{components:n,...o}=e;return(0,a.kt)("wrapper",(0,t.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"updating-gradle-dependencies"},"Updating Gradle Dependencies"),(0,a.kt)("p",null,"We use ",(0,a.kt)("a",{parentName:"p",href:"https://docs.gradle.org/current/userguide/platforms.html#sub:central-declaration-of-dependencies"},"Gradle Catalogs"),"\nto keep dependencies synced up across different Java projects. This is particularly useful for Airbyte Cloud, and can be\nused by any project seeking to build off Airbyte."),(0,a.kt)("p",null,"Catalogs allow dependencies to be represented as dependency coordinates. A user can reference preset dependencies/versions\nwhen declaring dependencies in a build script."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Version Catalog Example:"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"dependencies {\n   implementation(libs.groovy.core)\n}\n")),(0,a.kt)("p",{parentName:"blockquote"},"In this context, libs is a catalog and groovy represents a dependency available in this catalog. Instead of declaring a\nspecific version, we reference the version in the Catalog.")),(0,a.kt)("p",null,"This helps reduce the chances of dependency drift and dependency hell."),(0,a.kt)("p",null,"Thus, please use the Catalog when:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"declaring new common dependencies."),(0,a.kt)("li",{parentName:"ul"},"specifying new common dependencies.")),(0,a.kt)("p",null,"A common dependency is a foundational Java package e.g. Apache commons, Log4j etc that is often the basis on which libraries\nare built upon."),(0,a.kt)("p",null,"This is a relatively new addition, so devs should keep this in mind and use the top-level Catalog on a best-effort basis."),(0,a.kt)("h3",{id:"setup-details"},"Setup Details"),(0,a.kt)("p",null,"This section is for engineers wanting to understand Gradle Catalog details and how Airbyte has set this up."),(0,a.kt)("h4",{id:"the-version-catalog-toml-file-format"},"The version catalog TOML file format"),(0,a.kt)("p",null,"Gradle offers a conventional file to declare a catalog.\nIt\u2019s a conventional location to declare dependencies that are both consumed and published."),(0,a.kt)("p",null,"The TOML file consists of 4 major sections:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the ","[versions]"," section is used to declare versions which can be referenced by dependencies"),(0,a.kt)("li",{parentName:"ul"},"the ","[libraries]"," section is used to declare the aliases to coordinates"),(0,a.kt)("li",{parentName:"ul"},"the ","[bundles]"," section is used to declare dependency bundles"),(0,a.kt)("li",{parentName:"ul"},"the ","[plugins]"," section is used to declare plugins")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"TOML file Example:"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},'[versions]\ngroovy = "3.0.5"\n\n[libraries]\ngroovy-core = { module = "org.codehaus.groovy:groovy", version.ref = "groovy" }\n\n[bundles]\ngroovy = ["groovy-core", "groovy-json", "groovy-nio"]\n\n[plugins]\njmh = { id = "me.champeau.jmh", version = "0.6.5" }\n')),(0,a.kt)("p",{parentName:"blockquote"},"NOTE: for more information please follow ",(0,a.kt)("a",{parentName:"p",href:"https://docs.gradle.org/current/userguide/platforms.html#:~:text=The%20version%20catalog%20TOML%20file%20format"},"this")," link.")),(0,a.kt)("p",null,"As described above this project contains TOML file ",(0,a.kt)("inlineCode",{parentName:"p"},"deps.toml")," which is fully fulfilled with respect to ",(0,a.kt)("a",{parentName:"p",href:"https://docs.gradle.org/current/userguide/platforms.html#sub::toml-dependencies-format"},"official")," documentation.\nIn case when new versions should be used please update ",(0,a.kt)("inlineCode",{parentName:"p"},"deps.toml")," accordingly."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"deps.toml"),(0,a.kt)("p",null,"[versions]",'\nfasterxml_version = "2.13.0"\nglassfish_version = "2.31"\ncommons_io = "2.7"\nlog4j = "2.17.1"\nslf4j = "1.7.30"\nlombok = "1.18.22"\njunit-jupiter = "5.8.2"'),(0,a.kt)("p",null,"[libraries]",'\nfasterxml = { module = "com.fasterxml.jackson:jackson-bom", version.ref = "fasterxml_version" }\nglassfish = { module = "org.glassfish.jersey:jackson-bom", version.ref = "glassfish_version" }\njackson-databind = { module = "com.fasterxml.jackson.core:jackson-databind", version.ref = "fasterxml_version" }\njackson-annotations = { module = "com.fasterxml.jackson.core:jackson-annotations", version.ref = "fasterxml_version" }\njackson-dataformat = { module = "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml", version.ref = "fasterxml_version" }\njackson-datatype = { module = "com.fasterxml.jackson.datatype:jackson-datatype-jsr310", version.ref = "fasterxml_version" }\nguava = { module = "com.google.guava:guava", version = "30.1.1-jre" }\ncommons-io = { module = "commons-io:commons-io", version.ref = "commons_io" }\napache-commons = { module = "org.apache.commons:commons-compress", version = "1.20" }\napache-commons-lang = { module = "org.apache.commons:commons-lang3", version = "3.11" }\nslf4j-api = { module = "org.slf4j:slf4j-api", version = "1.7.30" }\nlog4j-api = { module = "org.apache.logging.log4j:log4j-api", version.ref = "log4j" }\nlog4j-core = { module = "org.apache.logging.log4j:log4j-core", version.ref = "log4j" }\nlog4j-impl = { module = "org.apache.logging.log4j:log4j-slf4j-impl", version.ref = "log4j" }\nlog4j-web = { module = "org.apache.logging.log4j:log4j-web", version.ref = "log4j" }\njul-to-slf4j = { module = "org.slf4j:jul-to-slf4j", version.ref = "slf4j" }\njcl-over-slf4j = { module = "org.slf4j:jcl-over-slf4j", version.ref = "slf4j" }\nlog4j-over-slf4j = { module = "org.slf4j:log4j-over-slf4j", version.ref = "slf4j" }\nappender-log4j2 = { module = "com.therealvan:appender-log4j2", version = "3.6.0" }\naws-java-sdk-s3 = { module = "com.amazonaws:aws-java-sdk-s3", version = "1.12.6" }\ngoogle-cloud-storage = { module = "com.google.cloud:google-cloud-storage", version = "2.2.2" }\ns3 = { module = "software.amazon.awssdk:s3", version = "2.16.84" }\nlombok = { module = "org.projectlombok:lombok", version.ref = "lombok" }\njunit-jupiter-engine = { module = "org.junit.jupiter:junit-jupiter-engine", version.ref = "junit-jupiter" }\njunit-jupiter-api = { module = "org.junit.jupiter:junit-jupiter-api", version.ref = "junit-jupiter" }\njunit-jupiter-params = { module = "org.junit.jupiter:junit-jupiter-params", version.ref = "junit-jupiter" }\nmockito-junit-jupiter = { module = "org.mockito:mockito-junit-jupiter", version = "4.0.0" }\nassertj-core = { module = "org.assertj:assertj-core", version = "3.21.0" }\njunit-pioneer = { module = "org.junit-pioneer:junit-pioneer", version = "1.6.2" }\nfindsecbugs-plugin = { module = "com.h3xstream.findsecbugs:findsecbugs-plugin", version = "1.11.0" }'),(0,a.kt)("p",null,"[bundles]","\njackson = ",'["jackson-databind", "jackson-annotations", "jackson-dataformat", "jackson-datatype"]',"\napache = ",'["apache-commons", "apache-commons-lang"]',"\nlog4j = ",'["log4j-api", "log4j-core", "log4j-impl", "log4j-web"]',"\nslf4j = ",'["jul-to-slf4j", "jcl-over-slf4j", "log4j-over-slf4j"]',"\njunit = ",'["junit-jupiter-api", "junit-jupiter-params", "mockito-junit-jupiter"]')),(0,a.kt)("h4",{id:"declaring-a-version-catalog"},"Declaring a version catalog"),(0,a.kt)("p",null,"Version catalogs can be declared in the settings.gradle file.\nThere should be specified section ",(0,a.kt)("inlineCode",{parentName:"p"},"dependencyResolutionManagement")," which uses ",(0,a.kt)("inlineCode",{parentName:"p"},"deps.toml")," file as a declared catalog."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Example:"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"dependencyResolutionManagement {\n    repositories {\n        maven {\n            url 'https://airbyte.mycloudrepo.io/public/repositories/airbyte-public-jars/'\n       }\n    }\n    versionCatalogs {\n        libs {\n            from(files(\"deps.toml\"))\n        }\n    }\n}\n"))),(0,a.kt)("h4",{id:"sharing-catalogs"},"Sharing Catalogs"),(0,a.kt)("p",null,"To share this catalog for further usage by other Projects, we do the following 2 steps:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Define ",(0,a.kt)("inlineCode",{parentName:"li"},"version-catalog")," plugin in ",(0,a.kt)("inlineCode",{parentName:"li"},"build.gradle")," file (ignore if this record exists)",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"plugins {\n    id '...'\n    id 'version-catalog'\n"))),(0,a.kt)("li",{parentName:"ul"},"Prepare Catalog for Publishing",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},'catalog {\n    versionCatalog {\n        from(files("deps.toml")) < --- declere either dependencies or specify existing TOML file\n    }\n}\n')))),(0,a.kt)("h4",{id:"configure-the-plugin-publishing-plugin"},"Configure the Plugin Publishing Plugin"),(0,a.kt)("p",null,"To ",(0,a.kt)("strong",{parentName:"p"},"Publishing"),", first define the ",(0,a.kt)("inlineCode",{parentName:"p"},"maven-publish")," plugin in ",(0,a.kt)("inlineCode",{parentName:"p"},"build.gradle")," file (ignore if this already exists):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"plugins {\n    id '...'\n    id 'maven-publish'\n}\n")),(0,a.kt)("p",null,"After that, describe the publishing section. Please use ",(0,a.kt)("a",{parentName:"p",href:"https://docs.gradle.org/current/userguide/publishing_gradle_plugins.html"},"this")," official documentation for more details."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Example:"),(0,a.kt)("pre",{parentName:"blockquote"},(0,a.kt)("code",{parentName:"pre",className:"language-gradle"},"publishing {\n    publications {\n        maven(MavenPublication) {\n            groupId = 'io.airbyte'\n            artifactId = 'oss-catalog'\n\n                from components.versionCatalog\n        }\n    }\n\n    repositories {\n        maven {\n            url 'https://airbyte.mycloudrepo.io/repositories/airbyte-public-jars'\n            credentials {\n                name 'cloudrepo'\n                username System.getenv('CLOUDREPO_USER')\n                password System.getenv('CLOUDREPO_PASSWORD')\n            }\n        }\n\n        mavenLocal()\n    }\n}\n"))))}p.isMDXComponent=!0}}]);